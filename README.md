# cash-report
现金日报相关工程的代码，以及自动化部署


## 月结单
月结单主要实现从指定飞书邮箱中获取邮件，并按照一定规则对邮件进行归档处理后，将属于不同银行以及不同类型的账单文件的邮件处理到不同的文件夹下，然后通过anycross进行附件下载，同时在anycross中调用python构建的fastapi接口来处理附件：
- 下载附件到临时目录
- 如果附件是zip格式，执行解压缩
- 如果附件PDF有密码，执行移除密码操作
- 如果附件PDF中嵌入了PDF文件，执行提取PDF文件操作
- 针对不同情况的PDF文档，根据实际情况进行分割文件操作，以获得需要用于解析的文件页面

再完成附件操作后，将需要解析的PDF的页面执行上传到多维表格，然后通过多维表格设计的字段以及对应的提示词，从PDF文档中提取到需要的字段内容，然后执行月结单基础信息的查询，并根据这些信息构建其转存的文件名以及对应的存储目录。

构建完成后，调用api接口执行将文件命名后存入到sharepoint指定目录的任务。

其中，分割附件PDF是为了控制其文档大小，限制其token以便于在多维表格通过字段提取信息时避免报错。

## 现金报告
现金报告执行的任务包括：
- 定时更新EMS Account List数据
- 定时汇总现金日报的活期数据

## 月度交易流水抽取
处理花旗银行和汇丰银行的月度账单文件，从其中抽取月度的交易记录，并自动归集到多维表格以便于AI进一步处理
- 花旗银行
- 汇丰银行

## 月度交易流水抽取
处理花旗银行和汇丰银行的月度账单文件，从其中抽取月度的交易记录，并自动归集到多维表格以便于AI进一步处理
- 花旗银行
- 汇丰银行
- 解析xls和csv文件
- 格式化抽取的数据
- 通过AI来处理交易记录的属性

## OA 报销付款申请单生成
通过集成平台将 OA 报销付款的数据通过API方式传递给应用，应用解析数据后使用 typst 根据预设的模板文件渲染生成 PDF 文件后，将文件上传给多维表格
- OA 通过webhook将数据提交给集成平台进行初步的整理
- 整理后的数据根据不同需求同步到多维表格中不同的数据表
- 主表数据进行检验后，并根据预设条件自动发送文档生成任务
- API接收到数据请求后，解析数据并根据typst模板生成PDF文件后，上传至多维表格